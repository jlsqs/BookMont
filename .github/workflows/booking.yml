name: Book Montgolfiere Class

on:
  schedule:
    # Lundi à 7h30 (FR) = 5h05 (UTC) - 25 minutes d'avance
    - cron: '05 5 * * 1'
    # Mardi à 8h40 (FR) = 6h15 (UTC) - 25 minutes d'avance
    - cron: '15 6 * * 2'
    # Mercredi à 7h30 (FR) = 5h05 (UTC) - 25 minutes d'avance
    - cron: '05 5 * * 3'
    # Jeudi à 8h35 (FR) = 6h10 (UTC) - 25 minutes d'avance
    - cron: '10 6 * * 4'
    # Vendredi à 8h35 (FR) = 6h10 (UTC) - 25 minutes d'avance
    - cron: '10 6 * * 5'
    # Samedi à 8h30 (FR) = 6h05 (UTC) - 25 minutes d'avance
    - cron: '05 6 * * 6'
    # Dimanche à 8h30 (FR) = 6h05 (UTC) - 25 minutes d'avance
    - cron: '05 6 * * 0'
  workflow_dispatch:  # Permet l'exécution manuelle
  push:  # S'exécute à chaque push pour tester
    branches: [ main ]

jobs:
  book-class:
    runs-on: ubuntu-latest
    timeout-minutes: 25  # Timeout après 25 minutes pour tenir compte du démarrage plus tôt
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Create .env file
      run: |
        echo "MONTGOLFIERE_EMAIL=${{ secrets.MONTGOLFIERE_EMAIL }}" >> .env
        echo "MONTGOLFIERE_PASSWORD=${{ secrets.MONTGOLFIERE_PASSWORD }}" >> .env
        
    - name: Run booking script
      run: npm start
      
    - name: Notify on success
      if: success()
      run: |
        echo "✅ Booking script executed successfully at $(date)"
        
    - name: Notify on failure
      if: failure()
      run: |
        echo "❌ Booking script failed at $(date)"
        exit 1 